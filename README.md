**Demo Exam 2025: –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è**

_–û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –∫–æ–º–ø–ª–µ–∫—Å–µ –æ—Ü–µ–Ω–æ—á–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —ç–∫–∑–∞–º–µ–Ω–∞ (–ö–û–î 09.02.06-1-2025)

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å–Ω—ã–π —ç—Ç–∞–ø](#–ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å–Ω—ã–π-—ç—Ç–∞–ø)
2. [–ú–æ–¥—É–ª—å 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã](#–º–æ–¥—É–ª—å-1-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-—Å–µ—Ç–µ–≤–æ–π-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã)
3. [–ú–æ–¥—É–ª—å 2: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å–µ—Ç–µ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è](#–º–æ–¥—É–ª—å-2-–æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è-—Å–µ—Ç–µ–≤–æ–≥–æ-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è)
4. [–ú–æ–¥—É–ª—å 3: –≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã](#–º–æ–¥—É–ª—å-3-—ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è-–æ–±—ä–µ–∫—Ç–æ–≤-—Å–µ—Ç–µ–≤–æ–π-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã)

---

## –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç–µ–ª—å–Ω—ã–π —ç—Ç–∞–ø

1. **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –∏ –º–∞—à–∏–Ω—ã**
   - Debian 12 "Bookworm" –∏–ª–∏ –∞–Ω–∞–ª–æ–≥ –Ω–∞ –∫–∞–∂–¥–æ–π VM.
   - –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ —Ç—Ä–µ–±—É–µ–º—ã—Ö —Å–µ—Ç–µ–≤—ã—Ö –∞–¥–∞–ø—Ç–µ—Ä–æ–≤:

     | –ú–∞—à–∏–Ω–∞    | –ê–¥–∞–ø—Ç–µ—Ä—ã                                   |
     |-----------|--------------------------------------------|
     | ISP       | ens18 (k HQ), ens19 (k BR), ens20 (WAN)    |
     | HQ-RTR    | ens18 (WAN), ens19 (LAN)                   |
     | BR-RTR    | ens18 (WAN), ens19 (LAN)                   |
     | HQ-SRV    | ens18 (+ 3 –¥–∏—Å–∫–∞ 1 –ì–ë –¥–ª—è RAID)            |
     | BR-SRV    | ens18                                     |
     | HQ-CLI    | ens18                                     |

2. **IP-–∞–¥—Ä–µ—Å–∞—Ü–∏—è** (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º VLAN 100/200/999 –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é)

   | –£—Å—Ç—Ä-–≤–æ   | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å     | IP/Mask          | –®–ª—é–∑          | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π               |
   |-----------|---------------|------------------|---------------|--------------------------|
   | ISP ens18 | ens18         | 172.16.4.1/28    | -             | —Å–≤—è–∑—å —Å HQ               |
   | ISP ens19 | ens19         | 172.16.5.1/28    | -             | —Å–≤—è–∑—å —Å BR               |
   | ISP ens20 | ens20         | DHCP             | -             | –≤—ã—Ö–æ–¥ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç         |
   | HQ-RTR    | ens18         | 172.16.4.2/28    | 172.16.4.1    |                          |
   | HQ-RTR    | ens19         | 192.168.100.1/24 | -             | LAN HQ                   |
   | BR-RTR    | ens18         | 172.16.5.2/28    | 172.16.5.1    |                          |
   | BR-RTR    | ens19         | 192.168.200.1/24 | -             | LAN BR                   |
   | HQ-SRV    | ens18         | 192.168.100.10/24| 192.168.100.1 |                          |
   | BR-SRV    | ens18         | 192.168.200.10/24| 192.168.200.1 |                          |
   | HQ-CLI    | ens18         | DHCP via HQ-RTR  | 192.168.100.1 |                          |
   | Tunnel    | tun0 (HQ)     | 10.10.10.1/30    | -             |                          |
   | Tunnel    | tun0 (BR)     | 10.10.10.2/30    | -             |                          |

3. **–î–æ–º–µ–Ω –¥–ª—è –≤—Å–µ—Ö –º–∞—à–∏–Ω**: `au-team.irpo`

---

# üì¶ –¢—Ä–µ–±—É–µ–º—ã–µ –ø–∞–∫–µ—Ç—ã –¥–ª—è –î–µ–º–æ—ç–∫–∑–∞–º–µ–Ω–∞ 2025

–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏–π —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.

---

## ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ –≤—Å–µ –º–∞—à–∏–Ω—ã (–æ–±—â–∏–µ –ø–∞–∫–µ—Ç—ã)

```bash
apt update && apt install -y \
  network-manager \
  net-tools \
  iproute2 \
  openssh-client \
  openssh-server \
  traceroute \
  curl \
  sudo
```

---

## üìå –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –º–∞—à–∏–Ω—ã

| –ú–∞—à–∏–Ω–∞     | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                | –ü–∞–∫–µ—Ç—ã –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ                                                                 |
|------------|-------------------------------------------|-------------------------------------------------------------------------------------|
| **ISP**    | –ò–Ω—Ç–µ—Ä–Ω–µ—Ç-—à–ª—é–∑ –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä             | `nftables`, `network-manager`                                                      |
| **HQ-RTR** | –û—Å–Ω–æ–≤–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä, DHCP, GRE, OSPF   | `nftables`, `network-manager`, `isc-dhcp-server`, `frr`, `frr-pythontools`         |
| **BR-RTR** | –†–µ–∑–µ—Ä–≤–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä, GRE, OSPF        | `nftables`, `network-manager`, `frr`, `frr-pythontools`                            |
| **HQ-SRV** | –°–µ—Ä–≤–µ—Ä HQ: DNS, NFS, RAID, Chrony         | `bind9`, `bind9-utils`, `nfs-kernel-server`, `mdadm`, `chrony`                     |
| **BR-SRV** | –°–µ—Ä–≤–µ—Ä BR: Samba AD DC, Ansible, Docker   | `samba`, `krb5-config`, `winbind`, `smbclient`, `ansible`, `docker.io`, `docker-compose` |
| **HQ-CLI** | –ö–ª–∏–µ–Ω—Ç: –≤—Ö–æ–¥ –≤ –¥–æ–º–µ–Ω                      | `realmd`, `sssd`, `sssd-tools`, `adcli`, `packagekit`, `samba-common-bin`          |

---

## –ú–æ–¥—É–ª—å 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–µ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: 1 —á. 00 –º–∏–Ω 

### 1. –ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ –∏–º—ë–Ω —Ö–æ—Å—Ç–∞–º
```bash
hostnamectl set-hostname hq-rtr.au-team.irpo
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ —Å nmcli
```bash
nmcli con add type ethernet con-name WAN ifname ens18 ip4 172.16.4.2/28 gw4 172.16.4.1
nmcli con mod WAN ipv4.dns 8.8.8.8
nmcli con up WAN

nmcli con add type ethernet con-name LAN ifname ens19 ip4 192.168.100.1/24
nmcli con up LAN
```

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ISP
```bash
nmcli con add type ethernet con-name TO-HQ ifname ens18 ip4 172.16.4.1/28
nmcli con up TO-HQ

nmcli con add type ethernet con-name TO-BR ifname ens19 ip4 172.16.5.1/28
nmcli con up TO-BR

nmcli con add type ethernet con-name WAN-DHCP ifname ens20
nmcli con up WAN-DHCP
```

### 4. –í–∫–ª—é—á–µ–Ω–∏–µ IP-—Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥–∞ –∏ NAT (nftables)
–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ NAT –∏ –≤–∫–ª—é—á–µ–Ω–∏—è IP-—Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥–∞ –Ω–∞ –≤–∞—à–∏—Ö –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞—Ö (HQ-RTR –∏ BR-RTR) –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

---

## 1. –í–∫–ª—é—á–∞–µ–º IP-—Ñ–æ—Ä–≤–∞—Ä–¥–∏–Ω–≥

1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª `/etc/sysctl.conf`:
   ```bash
   echo "net.ipv4.ip_forward=1" > /etc/sysctl.conf
   ```
2. –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É:
   ```bash
   sysctl -p
   ```
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ forwarding –≤–∫–ª—é—á—ë–Ω:
   ```bash
   sysctl net.ipv4.ip_forward
   # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å net.ipv4.ip_forward = 1
   ```

---

# 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NAT (MASQUERADE) —á–µ—Ä–µ–∑ iptables

–ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, –≤–∞—à ¬´–≤–Ω–µ—à–Ω–∏–π¬ª –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—ã—Ö–æ–¥–∞ –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç ‚Äî `enp0s8`. –¢–æ–≥–¥–∞:

## HQ-RTR

```bash
# Filter —Ç–∞–±–ª–∏—Ü–∞
iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -P OUTPUT ACCEPT

iptables -A FORWARD -i enp0s9  -o enp0s8 -j ACCEPT
iptables -A FORWARD -i enp0s10 -o enp0s8 -j ACCEPT
iptables -A FORWARD -i enp0s9  -o enp0s9 -m state --state RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -i enp0s10 -o enp0s10 -m state --state RELATED,ESTABLISHED -j ACCEPT

# NAT —Ç–∞–±–ª–∏—Ü–∞
iptables -t nat -P PREROUTING ACCEPT
iptables -t nat -P INPUT ACCEPT
iptables -t nat -P OUTPUT ACCEPT
iptables -t nat -P POSTROUTING ACCEPT

iptables -t nat -A POSTROUTING -s 192.168.1.0/26 -o enp0s8 -j MASQUERADE
iptables -t nat -A POSTROUTING -s 192.168.2.0/26 -o enp0s8 -j MASQUERADE
```

---

## BR-RTR

```bash
# Filter —Ç–∞–±–ª–∏—Ü–∞
iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -P OUTPUT ACCEPT

iptables -A FORWARD -i enp0s9 -o enp0s8 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT
iptables -A FORWARD -i enp0s9 -o enp0s9 -m state --state NEW,RELATED,ESTABLISHED -j ACCEPT

# NAT —Ç–∞–±–ª–∏—Ü–∞
iptables -t nat -P PREROUTING ACCEPT
iptables -t nat -P INPUT ACCEPT
iptables -t nat -P OUTPUT ACCEPT
iptables -t nat -P POSTROUTING ACCEPT

iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o enp0s8 -j MASQUERADE
---

## 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª iptables –Ω–∞ Debian

–ß—Ç–æ–±—ã –ø—Ä–∞–≤–∏–ª–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–≥—Ä—É–∂–∞–ª–∏—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏:

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª:
   ```bash
   apt update
   apt install -y iptables-persistent
   ```
2. –ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –ø—Ä–∞–≤–∏–ª.  
   –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–∞ –ø–æ—è–≤–∏–ª–∏—Å—å –ø–æ–∑–∂–µ, —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤—Ä—É—á–Ω—É—é:
   ```bash
   netfilter-persistent save
   ```

---

## 4. –ü—Ä–æ–≤–µ—Ä–∫–∞

1. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç–µ–∫—É—â–∏–µ NAT-–ø—Ä–∞–≤–∏–ª–∞:
   ```bash
   iptables -t nat -L -n -v
   ```
2. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∞–≤–∏–ª–∞ FORWARD:
   ```bash
   iptables -L FORWARD -n -v
   ```
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏–∑ LAN:
   ```bash
   # –Ω–∞ HQ-CLI –∏–ª–∏ –ª—é–±–æ–π –º–∞—à–∏–Ω–µ –∏–∑ –ø–æ–¥—Å–µ—Ç–∏
   ping -c3 8.8.8.8
   curl -I http://example.com
   ```


### 5. GRE-—Ç—É–Ω–Ω–µ–ª—å
 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GRE-—Ç—É–Ω–Ω–µ–ª—è —á–µ—Ä–µ–∑ nmtui

–í —ç—Ç–æ–º —Ñ–∞–π–ª–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã —Ç–æ—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª–µ–π –¥–ª—è –¥–≤—É—Ö –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–æ–≤: HQ-RTR –∏ BR-RTR, –ø–æ —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º–µ.

---

## 1. HQ-RTR (172.16.4.2 ‚Üî 172.16.5.2)

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `nmtui` ‚Üí **Edit a connection** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à IP-tunnel (–Ω–∞–ø—Ä–∏–º–µ—Ä, `gre-tun0`) ‚Üí **Edit**:

   ```text
   Profile name:  gre-tun0
   Device:        tun0

   ‚îÄ‚îÄ IP tunnel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Mode:          GRE
   Parent:        ens18
   Local IP:      172.16.4.2
   Remote IP:     172.16.5.2
   MTU:           1400

   ‚îÄ‚îÄ IPv4 CONFIGURATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Method:        Manual
   Addresses:     10.10.10.1/30     # —Ç—É–Ω–Ω–µ–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å
   Gateway:       (leave empty)    # —à–ª—é–∑ –Ω–µ –Ω—É–∂–µ–Ω
   DNS servers:   (leave empty)
   ```

2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ **Activate** ‚Üí `gre-tun0`.

---

## 2. BR-RTR (172.16.5.2 ‚Üî 172.16.4.2)

1. –í `nmtui` ‚Üí **Edit a connection** ‚Üí –≤–∞—à —Ç—É–Ω–Ω–µ–ª—å ‚Üí **Edit**:

   ```text
   Profile name:  gre-tun0
   Device:        tun0

   ‚îÄ‚îÄ IP tunnel ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Mode:          GRE
   Parent:        ens18
   Local IP:      172.16.5.2
   Remote IP:     172.16.4.2
   MTU:           1400

   ‚îÄ‚îÄ IPv4 CONFIGURATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
   Method:        Manual
   Addresses:     10.10.10.2/30
   Gateway:       (leave empty)
   DNS servers:   (leave empty)
   ```

2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ **Activate** ‚Üí `gre-tun0`.

---

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `tun0` –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–Ω–∏–º–∞—Ç—å—Å—è —Å –Ω—É–∂–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ NetworkManager.


### 6. OSPF (FRR)
```bash
apt install -y frr frr-pythontools
# /etc/frr/daemons: zebra=yes ospfd=yes
systemctl enable --now frr
vtysh <<EOF
conf t
router ospf
 ospf router-id 1.1.1.1       # HQ (BR: 2.2.2.2)
 network 10.10.10.0/30 area 0
 network 192.168.100.0/24 area 0
 passive-interface ens19
 area 0 authentication message-digest
 interface tun0
  ip ospf message-digest-key 1 md5 MySecretPass
exit
write
EOF
```

### 7. DHCP-—Å–µ—Ä–≤–µ—Ä (HQ-RTR DHCP)
```bash
apt install -y isc-dhcp-server
authoritative;

option domain-name "au-team.irpo";
option domain-name-servers 192.168.1.2, 8.8.8.8;

subnet 192.168.2.0 netmask 255.255.255.240 {
    range 192.168.2.2 192.168.2.14;
    option routers 192.168.2.1;
    option broadcast-address 192.168.2.15;
    option domain-search "au-team.irpo";
}

systemctl enable --now isc-dhcp-server
reboot
```

### 8. DNS-—Å–µ—Ä–≤–µ—Ä (BIND9)
# –ü–æ–ª–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ BIND9 –∏ —Ä–µ–∑–æ–ª—å–≤–µ—Ä–∞ –Ω–∞ HQ-SRV

## 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ BIND

```bash
apt update
apt install -y bind9 bind9-utils
```

---

## 2. –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `/etc/bind/named.conf.options`

–î–æ–±–∞–≤—å—Ç–µ –≤–Ω—É—Ç—Ä—å –±–ª–æ–∫–∞ `options { ‚Ä¶ };` —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏:

```conf
options {
    directory "/var/cache/bind";

    recursion yes;
    allow-query { any; };
    forwarders {
        8.8.8.8;
        8.8.4.4;
    };
    dnssec-validation auto;
};
```

---

## 3. –û–ø–∏—Å–∞–Ω–∏–µ –∑–æ–Ω –≤ `/etc/bind/named.conf.local`

```conf
# –ü—Ä—è–º–∞—è –∑–æ–Ω–∞
zone "au-team.irpo" {
    type master;
    file "/etc/bind/db.au-team.irpo";
};

# –û–±—Ä–∞—Ç–Ω—ã–µ –∑–æ–Ω—ã
zone "1.168.192.in-addr.arpa" {
    type master;
    file "/etc/bind/db.192.168.1";
};

zone "2.168.192.in-addr.arpa" {
    type master;
    file "/etc/bind/db.192.168.2";
};

zone "0.168.192.in-addr.arpa" {
    type master;
    file "/etc/bind/db.192.168.0";
};
```

---

## 4. –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤ –∑–æ–Ω

### 4.1 `/etc/bind/db.au-team.irpo`

```zone
$TTL 604800
@    IN SOA  hq-srv.au-team.irpo. admin.au-team.irpo. ( 1 604800 86400 2419200 604800 )
;
@      IN NS    hq-srv.au-team.irpo.

; A-–∑–∞–ø–∏—Å–∏
hq-rtr  IN A     172.16.4.2
br-rtr  IN A     172.16.5.2
hq-srv  IN A     192.168.1.2
hq-cli  IN A     192.168.2.2
br-srv  IN A     192.168.0.2

; CNAME-–∑–∞–ø–∏—Å–∏
moodle  IN CNAME hq-rtr.au-team.irpo.
wiki    IN CNAME hq-rtr.au-team.irpo.
```

### 4.2 `/etc/bind/db.192.168.1`

```zone
$TTL 604800
@    IN SOA  hq-srv.au-team.irpo. admin.au-team.irpo. ( 2 604800 86400 2419200 604800 )
;
@      IN NS    hq-srv.au-team.irpo.

; PTR-–∑–∞–ø–∏—Å–∏
2      IN PTR   hq-srv.au-team.irpo.
```

### 4.3 `/etc/bind/db.192.168.2`

```zone
$TTL 604800
@    IN SOA  hq-srv.au-team.irpo. admin.au-team.irpo. ( 3 604800 86400 2419200 604800 )
;
@      IN NS    hq-srv.au-team.irpo.

; PTR-–∑–∞–ø–∏—Å—å
2      IN PTR   hq-cli.au-team.irpo.
```

### 4.4 `/etc/bind/db.192.168.0`

```zone
$TTL 604800
@    IN SOA  hq-srv.au-team.irpo. admin.au-team.irpo. ( 4 604800 86400 2419200 604800 )
;
@      IN NS    hq-srv.au-team.irpo.

; PTR-–∑–∞–ø–∏—Å—å
2      IN PTR   br-srv.au-team.irpo.
```

---

## 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ DNS

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
named-checkconf
named-checkzone au-team.irpo       /etc/bind/db.au-team.irpo
named-checkzone 1.168.192.in-addr.arpa /etc/bind/db.192.168.1
named-checkzone 2.168.192.in-addr.arpa /etc/bind/db.192.168.2
named-checkzone 0.168.192.in-addr.arpa /etc/bind/db.192.168.0

# –ó–∞–ø—É—Å–∫ –∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
systemctl enable --now bind9
```

---

## 6. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ `resolv.conf`

–î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ `/etc/resolv.conf`:

```text
search au-team.irpo
nameserver 127.0.0.1
```

---

## 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –õ–æ–∫–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ BIND
dig @127.0.0.1 hq-rtr.au-team.irpo A +short
dig @127.0.0.1 -x 192.168.2.2 +short

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω–µ—à–Ω–µ–π —Ä–µ–∑–æ–ª—é—Ü–∏–∏ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–≤–∞—Ä–¥–µ—Ä
dig @127.0.0.1 example.com +short

# –ü—Ä–æ–≤–µ—Ä–∫–∞ ping –ø–æ –∏–º–µ–Ω–∏
ping -c3 hq-rtr.au-team.irpo
```

---

## –ú–æ–¥—É–ª—å 2: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Å–µ—Ç–µ–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è

## 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Samba –Ω–∞ BR-SRV
```bash
sudo apt-get update && sudo apt-get install samba samba-common smbclient winbind libnss-winbind libpam-winbind
sudo samba-tool domain provision --realm=HQ.LOCAL --domain=HQ --server-role=dc --dns-backend=SAMBA_INTERNAL --adminpass='StrongAdminP@ssw0rd'
sudo systemctl enable smb nmb winbind
sudo systemctl start smb nmb winbind
sudo samba-tool group add hq
sudo samba-tool user create user1.hq Passw0rd123 --given-name="User One" --surname="HQ"
sudo samba-tool user create user2.hq Passw0rd123 --given-name="User Two" --surname="HQ"
sudo samba-tool user create user3.hq Passw0rd123 --given-name="User Three" --surname="HQ"
sudo samba-tool user create user4.hq Passw0rd123 --given-name="User Four" --surname="HQ"
sudo samba-tool user create user5.hq Passw0rd123 --given-name="User Five" --surname="HQ"
sudo samba-tool group addmembers hq "user1.hq","user2.hq","user3.hq","user4.hq","user5.hq"
while IFS=, read -r login pass fullname; do 
    sudo samba-tool user create "$login" "$pass" --fullname="$fullname"
    sudo samba-tool group addmembers hq "$login"
done < /opt/users.csv
```

## 2. –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ HQ-CLI –∫ –¥–æ–º–µ–Ω—É
```bash
sudo apt-get install samba-common realmd sssd adcli krb5-user libnss-winbind libpam-winbind
sudo realm join --user=Administrator HQ.LOCAL
getent passwd user1.hq@HQ.LOCAL
getent group hq@HQ.LOCAL
sudo systemctl restart sssd
sudo visudo  # –¥–æ–±–∞–≤–∏—Ç—å: %hq ALL=(ALL) NOPASSWD: /usr/bin/cat, /usr/bin/grep, /usr/bin/id
```

## 3. RAID5 –∏ NFS –Ω–∞ HQ-SRV
```bash
sudo apt-get install mdadm
sudo mdadm --create --verbose /dev/md0 --level=5 --raid-devices=3 /dev/sdb /dev/sdc /dev/sdd
sudo mdadm --detail --scan | sudo tee -a /etc/mdadm.conf
sudo update-initramfs -u
sudo parted /dev/md0 --script mklabel gpt
sudo parted /dev/md0 --script mkpart primary ext4 0% 100%
sudo mkfs.ext4 /dev/md0p1
sudo mkdir -p /raid5
sudo mount /dev/md0p1 /raid5
# –î–æ–±–∞–≤–∏—Ç—å –≤ /etc/fstab:
# UUID=<UUID> /raid5 ext4 defaults 0 0

sudo apt-get install nfs-kernel-server
sudo mkdir /raid5/nfs
sudo chown nobody:nogroup /raid5/nfs
# –í /etc/exports:
/raid5/nfs 192.168.20.0/24(rw,sync,no_subtree_check,no_root_squash)
sudo exportfs -r
exportfs -v
showmount -e localhost

# –ù–∞ HQ-CLI:
sudo apt-get install nfs-common
sudo mkdir -p /mnt/nfs
# –í /etc/fstab:
# 192.168.20.10:/raid5/nfs /mnt/nfs nfs defaults,_netdev 0 0
sudo mount -a
touch /mnt/nfs/testfile && echo "NFS OK" > /mnt/nfs/testfile
```

## 4. Chrony
```bash
# –ù–∞ HQ-RTR:
sudo apt-get install chrony
# –í /etc/chrony.conf: –¥–æ–±–∞–≤–∏—Ç—å local stratum 5 –∏ allow 192.168.20.0/24, allow 192.168.10.0/24
sudo systemctl enable chronyd
sudo systemctl restart chronyd

# –ù–∞ –∫–ª–∏–µ–Ω—Ç–∞—Ö:
sudo apt-get install chrony
# –í /etc/chrony.conf: –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å pool*, –¥–æ–±–∞–≤–∏—Ç—å server 192.168.20.1 iburst
sudo systemctl enable chronyd
sudo systemctl restart chronyd
chronyc tracking
chronyc sources
```

## 5. Ansible –Ω–∞ BR-SRV
```bash
sudo apt-get install ansible
ssh-keygen -t rsa
ssh-copy-id sshuser@192.168.20.10
ssh-copy-id sshuser@192.168.20.20
ssh-copy-id net_admin@192.168.20.1
ssh-copy-id net_admin@192.168.10.1
# –í /etc/ansible/hosts: –¥–æ–±–∞–≤–∏—Ç—å hq-srv, hq-cli, hq-rtr, br-rtr
# –í /etc/ansible/ansible.cfg: host_key_checking = False
ansible all -m ping
```

## 6. Docker MediaWiki –Ω–∞ BR-SRV
```bash
sudo apt-get install docker.io docker-compose-plugin
sudo apt-get install docker-compose
# –°–æ–∑–¥–∞—Ç—å ~/wiki.yml –∏ ~/LocalSettings.php
docker-compose -f wiki.yml up -d
docker-compose ps
docker-compose logs -f
curl http://192.168.10.10:8080
```

## 7. NAT –Ω–∞ BR-RTR (Wiki)
```bash
sudo iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 80 -j DNAT --to 192.168.10.10:8080
sudo iptables -t nat -A POSTROUTING -o eth1 -p tcp -d 192.168.10.10 --dport 8080 -j MASQUERADE
# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞: iptables-save > /etc/iptables/rules.v4
```

## 8. Moodle –Ω–∞ HQ-SRV
```bash
sudo apt-get install apache2 php libapache2-mod-php
sudo apt-get install php-mysql php-xml php-gd php-intl php-curl php-zip php-mbstring
sudo apt-get install mariadb-server
sudo mysql_secure_installation
sudo mysql -u root -p
# –í mysql:
CREATE DATABASE moodledb DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'moodle'@'localhost' IDENTIFIED BY 'P@ssw0rd';
GRANT ALL PRIVILEGES ON moodledb.* TO 'moodle'@'localhost';
FLUSH PRIVILEGES;
EXIT;
cd /tmp
wget https://download.moodle.org/download.php/direct/stable401/moodle-4.1.5.tgz -O moodle.tgz
sudo tar -xzvf moodle.tgz -C /var/www/
sudo mv /var/www/moodle /var/www/html/moodle
sudo mkdir /var/moodledata
sudo chown -R www-data:www-data /var/moodledata
sudo chmod 0777 /var/moodledata
sudo chown -R www-data:www-data /var/www/html/moodle
sudo a2ensite moodle.conf
sudo a2dissite 000-default.conf
sudo systemctl reload apache2
```

## 9. Nginx Reverse Proxy –Ω–∞ HQ-RTR
```bash
sudo apt-get install nginx
# –°–æ–∑–¥–∞—Ç—å /etc/nginx/sites-available/moodle.au-team.irpo.conf –∏ wiki.au-team.irpo.conf
sudo ln -s /etc/nginx/sites-available/moodle.au-team.irpo.conf /etc/nginx/sites-enabled/
sudo ln -s /etc/nginx/sites-available/wiki.au-team.irpo.conf /etc/nginx/sites-enabled/
sudo rm /etc/nginx/sites-enabled/default
sudo nginx -t && sudo systemctl reload nginx
```

## 10. –Ø–Ω–¥–µ–∫—Å.–ë—Ä–∞—É–∑–µ—Ä –Ω–∞ HQ-CLI
```bash
sudo apt-get update
sudo apt-get install yandex-browser-stable
yandex-browser --version
```

